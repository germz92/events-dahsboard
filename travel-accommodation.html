<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Travel and Accommodation</title>
  <link rel="shortcut icon" type="image/x-icon" href="assets/favicon.png">
  <link rel="stylesheet" href="css/travel-accommodation.css">
  <script src="js/config.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    textarea, input[type="text"], input[type="time"] {
      width: 100%;
      min-height: 34px;
      resize: none;
      overflow: hidden;
      line-height: 1.4;
      font-size: 14px;
      padding: 6px;
      box-sizing: border-box;
      font-family: inherit;
      white-space: pre-wrap;
      word-break: break-word;
    }

    td.text {
      max-width: 200px;
    }

    .edit-btn, .save-btn {
      margin: 20px;
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
    }

    .edit-btn { background-color: #007BFF; color: white; }
    .save-btn { background-color: #28a745; color: white; display: none; }
    .readonly-span { display: inline-block; padding: 6px; white-space: pre-wrap; word-break: break-word; }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 70px;
      background: #fff;
      border-top: 1px solid #ccc;
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      padding-top: 6px;
      padding-bottom: env(safe-area-inset-bottom, 10px);
      z-index: 1000;
    }

    .bottom-nav a {
      color: #007BFF;
      text-decoration: none;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      padding-bottom: 12px;
    }

    .bottom-nav a:hover {
      background-color: #f0f0f0;
    }

    .bottom-nav i {
      stroke: #007BFF;
      width: 20px;
      height: 20px;
      margin-bottom: 4px;
    }
  </style>
</head>

<body>
  <h1 id="eventTitle" style="text-align: center;"></h1>

  <div style="text-align:center">
    <button class="edit-btn" id="editModeBtn" onclick="enterEditMode()">Edit</button>
    <button class="save-btn" id="saveBtn" onclick="saveData()">Save</button>
  </div>

  <!-- Travel Table -->
  <div class="section">
    <h2>Travel</h2>
    <div class="table-wrapper">
      <table id="travelTable">
        <thead>
          <tr>
            <th class="date">Date</th>
            <th class="time">Time</th>
            <th class="text">Name</th>
            <th class="text">Airline</th>
            <th class="text">Ref Number</th>
            <th class="action"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="add-btn" onclick="addRow('travelTable')">+ Row</button>
  </div>

  <!-- Accommodation Table -->
  <div class="section">
    <h2>Accommodation</h2>
    <div class="table-wrapper">
      <table id="accommodationTable">
        <thead>
          <tr>
            <th class="date">Check-In</th>
            <th class="date">Check-Out</th>
            <th class="text">Hotel</th>
            <th class="text">Name</th>
            <th class="text">Ref Number</th>
            <th class="action"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <button class="add-btn" onclick="addRow('accommodationTable')">+ Row</button>
  </div>

  <!-- Bottom Navigation Bar -->
  <nav class="bottom-nav">
    <a href="events.html"><i data-lucide="home"></i><span>Home</span></a>
    <a id="navGeneral"><i data-lucide="info"></i><span>General</span></a>
    <a id="navCrew"><i data-lucide="users"></i><span>Crew</span></a>
    <a id="navTravel"><i data-lucide="plane"></i><span>Travel</span></a>
    <a id="navGear"><i data-lucide="camera"></i><span>Gear</span></a>
    <a id="navCard"><i data-lucide="memory-stick"></i><span>Cards</span></a>
    <a id="navSchedule"><i data-lucide="calendar"></i><span>Schedule</span></a>
  </nav>

  <script>
    const token = localStorage.getItem('token');
    const params = new URLSearchParams(window.location.search);
    const tableId = params.get('id');
    let isOwner = false;
    let editMode = false;

    document.addEventListener("DOMContentLoaded", async () => {
      const res = await fetch(`${API_BASE}/api/tables/${tableId}`, {
        headers: { Authorization: token }
      });

      if (res.ok) {
        const table = await res.json();
        document.getElementById('eventTitle').textContent = table.title;

        const userId = getUserIdFromToken();
        isOwner = Array.isArray(table.owners) && table.owners.includes(userId);

        if (!isOwner) {
          document.getElementById('editModeBtn').style.display = 'none';
        }

        loadData();
      }

      // Set bottom nav links
      const navLinks = [
        { id: 'navGeneral', file: 'general.html' },
        { id: 'navCrew', file: 'crew.html' },
        { id: 'navTravel', file: 'travel-accommodation.html' },
        { id: 'navGear', file: 'gear.html' },
        { id: 'navCard', file: 'card-log.html' },
        { id: 'navSchedule', file: 'schedule.html' }
      ];
      navLinks.forEach(({ id, file }) => {
        const el = document.getElementById(id);
        if (el) el.href = `${file}?id=${tableId}`;
      });

      if (window.lucide) lucide.createIcons();
    });

    function getUserIdFromToken() {
      if (!token) return null;
      const payload = JSON.parse(atob(token.split('.')[1]));
      return payload.id;
    }

    // (functions: loadData, formatTo12Hour, populateTable, autoResizeTextarea, etc.)
    // are already defined above and remain unchanged
  </script>
</body>
</html>
